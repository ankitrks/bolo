{% extends "payment/base.html" %}

{% load static %}

{% block center_content %}


<div class="row">
    <div class="col-sm-12"  style="margin-left: 10px">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Beneficiary</h3>
            </div>
            <div class="box-body">
                <div class="col-sm-4">
                    <a href="#" class="btn btn-success" data-toggle="modal" data-target="#modal-add-beneficiary">
                        Add Beneficiary
                    </a>
                </div>
                <div style="margin-left: 10px">
                    <div class="row" id="beneficiaryTable"></div>
                </div>
                
            </div>
        </div>
    </div>
</div>
    {% include "payment/partner/components/add_beneficiary_form.html" %}
{% endblock center_content %}

{% block local_js %}
    
<script type="text/javascript">
$("#beneficiaryTable").jsGrid({
    width: "100%",
    height: "400px",

    inserting: false,
    editing: false,
    sorting: true,
    paging: true,
    pageLoading: true,
    autoload: true,
    fields: [
        { title: "ID", name: "id", type: "number", visible:false },
        { title: "Name", name: "beneficiary_link", type: "text", width: 60},
        { title: "BI ID", name: "boloindya_id", type: "number", width: 50 },
        { title: "Payment Method", name: "payment_method", type: "select", width: 50, 
            items: [{
                        text: 'Paytm Wallet', 
                        value:'paytm_wallet'
                    },{
                        text: 'UPI', 
                        value:'upi'
                    },{
                        text: 'Account Transfer',
                        value:'account_transfer'
                    }],
            valueField: "value",             // name of property of item to be used as value
            textField: "text", 
        },
        { title: "PayTM Number", name: "paytm_number", type: "text", width: 75 },
        { title: "UPI", name: "upi", type: "text", width: 50 },
        { title: "Account Number", name: "account_number", type: "number", width: 50 },
        { title: "Bank IFSC", name: "bank_ifsc", type: "text", width: 50 },
        { title: "Active", type: "checkbox", name: "is_active", sorting: false, width:22 },
        { type: "control" }
    ],
    controller: {
        loadData: function(filter) {
            console.log("------ loadData ", filter)
            return $.ajax({
                type: "GET",
                url: "/api/v1/payment/beneficiary/",
                data: filter
            });
        },
        
        insertItem: function(item) {
            return $.ajax({
                type: "POST",
                url: "/api/v1/payment/beneficiary/",
                data: item
            });
        },
        
        updateItem: function(item) {
            return $.ajax({
                type: "PUT",
                url: "/api/v1/payment/beneficiary/"+item.id + "/",
                data: item
            });
        },
        
        deleteItem: function(item) {
            return $.ajax({
                type: "DELETE",
                url: "/api/v1/payment/beneficiary/"+item.id,
                data: item
            });
        }
    }
});
</script>
<script  type="text/javascript">
    $(document).ready(function(){
        $('#save_beneficiary').on('click', function(){
            let data = $('#beneficiaryForm').serializeArray()
            let formData = {}
            $.each(data, (i, item) => {formData[item.name] = item.value})
            $.ajax('/api/v1/payment/beneficiary/', {
                method: 'POST',
                data: formData,
                success: function(response){
                    $('#modal-add-beneficiary').find('#exit_add_beneficiary_form').click()
                    Swal.fire(
                      'Success!',
                      'Beneficiary added successfully!',
                      'success'
                    )

                }
            })    
            return true
        });
    });
</script>
{% endblock local_js %}