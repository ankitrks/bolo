{% extends "jarvis/layout/base.html" %}

{% block styles %}
<style>
    #overlay {
  position: fixed; /* Sit on top of the page content */
  display: none; /* Hidden by default */
  width: 100%; /* Full width (cover the whole page) */
  height: 100%; /* Full height (cover the whole page) */
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.5); /* Black background with opacity */
  z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
  cursor: pointer; /* Add a pointer on hover */
}
.percentcomplete{
    position: absolute;
    top: 50%;
    left:50%;
    color: white;
    transform: translate(-50%,-50%);
}
</style>
{% endblock styles %}


{% block content %}
{% load staticfiles %}
<section>
  <div style="text-align: center;">
      <h1>Active User Statistics</h1>
  </div>
  
  <div class="row">
    <div style="text-align: center;"  class="col-6">
      <h2>Daily Active Users</h2>
      <canvas id="chart_dau"></canvas>    
    </div>

    <div style="text-align: center;"  class="col-6">
      <h2>Monthly Active Users</h2>
      <canvas id="chart_mau"></canvas>    
    </div>

    <div style="text-align: center;"  class="col-6">
      <h2>Hourly Active Users</h2>
      <canvas id="chart_hau"></canvas>    
    </div>    

  </div>

  <!-- jQuery 3 -->
  <!-- <script src="../../bower_components/jquery/dist/jquery.min.js"></script> -->
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>

  <!-- Bootstrap 3.3.7 -->
  <!-- <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script> -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <!-- ChartJS -->
  <script type="text/javascript" src="{% static 'js/Chart.min.js' %}"></script>

  <script type="text/javascript">

      var chart_dau = document.getElementById('chart_dau').getContext('2d');
      var chart_mau = document.getElementById('chart_mau').getContext('2d');
      var chart_hau = document.getElementById('chart_hau').getContext('2d');

      $( document ).ready(function() {
        getStatsData();
      });

      function getStatsData(){
        $.ajax({
            headers: { "X-CSRFToken": getCookie("csrftoken") },
            url: "/jarvis/get_user_stats/",
            type: "GET", 
            contentType : 'application/json',
            success: function (data) {
                setCharts(data);
            }
        });
      }

      function setCharts(data){
        console.log(data);

        //****** Setting DAU chart
          var chart = new Chart(chart_dau, {
            type: 'line',

            data: {
                // labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                labels: data.dau_labels,
                datasets: [{
                    label: 'Daily Active Users',
                    // label: data.dau_labels
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: data.dau_freq
                }]
            },

            options: {}
          }); 

          //****** Setting MAU chart
          var chart = new Chart(chart_mau, {
            type: 'line',

            data: {
                // labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                labels: data.mau_labels,
                datasets: [{
                    label: 'Monthly Active Users',
                    backgroundColor: 'rgb(141, 233, 190)',
                    borderColor: 'rgb(141, 233, 190)',
                    data: data.mau_freq
                }]
            },

            options: {}
          }); 

          //****** Setting HAU chart
          var chart = new Chart(chart_hau, {
            type: 'line',

            data: {
                labels: data.hau_labels,
                datasets: [{
                    label: 'Hourly Active Users',
                    backgroundColor: 'rgb(100, 167, 255)',
                    borderColor: 'rgb(100, 167, 255)',
                    data: data.hau_freq
                }]
            },

            options: {}
          }); 
      }

      function getCookie(c_name)
      {
          if (document.cookie.length > 0)
          {
              c_start = document.cookie.indexOf(c_name + "=");
              if (c_start != -1)
              {
                  c_start = c_start + c_name.length + 1;
                  c_end = document.cookie.indexOf(";", c_start);
                  if (c_end == -1) c_end = document.cookie.length;
                  return unescape(document.cookie.substring(c_start,c_end));
              }
          }
          return "";
      }
  </script>

</section>
{% endblock content %}
