{% extends 'advertisement/base.html' %}

{% block center_content %}
<div class="row">
    <div class="col-sm-12"  style="margin-left: 10px margin-right: 10px">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Ad Dashboard</h3>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-aqua">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Ongoing Ad (Current)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-bag"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-green">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Upcoming Ad (Current)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-stats-bars"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-yellow">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Added to draft (all)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-person-add"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-red">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Onboarded Products (Live)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-pie-graph"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-aqua">
                            <div class="inner">
                                <h3 class="value-count">20000</h3>
                                <p class="section-name">Impressions (Date)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-bag"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-green">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">No. of skips (Date)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-stats-bars"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-yellow">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Install clicks (Date)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-person-add"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-red">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Shop Now clicks (Date)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-pie-graph"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-aqua">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Onboarded Brands (Live)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-bag"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-xs-2 col-md-2 col-xl-2">
                        <div class="small-box bg-green">
                            <div class="inner">
                                <h3 class="value-count">20</h3>
                                <p class="section-name">Learn More (Date)</p>
                            </div>
                            <div class="icon">
                                <i class="ion ion-stats-bars"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12"  style="margin-left: 10px">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Ad</h3>
            </div>
            <div class="box-body">
                <div class="row" style="margin-bottom: 10px">
                    <div class="col-sm-4">
                        <div class="input-group">
                            <input type="text" name="q" class="form-control" placeholder="Search...">
                            <span class="input-group-btn">
                                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <div style="margin-left: 10px">
                    <div class="row" id="adTable"></div>
                </div>
                
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="frequencyModal" tabindex="-1" role="dialog" aria-labelledby="frequencyModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
                
            </div>
        </div>
    </div>
</div>

{% endblock center_content %}

{% block local_js %}
<script type="text/javascript">
let headers = {}

$("#adTable").jsGrid({
    width: "100%",
    height: "600px",

    inserting: false,
    editing: false,
    sorting: true,
    paging: true,
    pageLoading: true,
    autoload: true,
    pageSize: 15,
    fields: [
        { title: " ", name: "ad_id", type: "renderer", rendererFunction: function(value, data){
            return `<input type="checkbox" name="mark_for_export" value="${ value }"/>`
        }, width: 22, align: "center",},
        { title: "Sr. No.", name: "ad_id", type: "number", width: 30, align: "center"},
        { title: "Brand ID", name: "brand_id", type: "text", align: "center", width: 40},
        { title: "Brand Name", name: "brand_name", type: "text", align: "center"},
        { title: "Start Date", name: "start_date", type: "text", width: 60, align: "center"},
        { title: "End Date", name: "end_date", type: "text", width: 60, align: "center"},
        { title: "Frequency", name: "frequency", type: "renderer", rendererFunction: function(value, data){
            console.log("freq val", value, data)
            let html= `<div><b>Type: ${ data.frequency_type }</b></div>`

            if(data.frequency_type == 'constant'){
                html += `<div>Scrolls: ${ data.frequency[0]['scroll'] }</div>`
            }
            else if(data.frequency_type == 'variable'){
                html += `<table>
                    <tr>
                        <th>Sequence</th>
                        <th>Scroll</th>
                    </tr>`
                data.frequency.forEach(function(val){
                    html += `<tr>
                        <td>${ val.sequence }</td>
                        <td>${ val.scroll }</td>
                    </tr>`
                })
                html += '</table>'
            }
            return `<a class="frequency-element" data-toggle="modal" data-target="#frequencyModal" data-modalbody="${ html }">Detail</a>`
        }, align: "center"},
        { title: "Video", name: "ad_video", type: "html", template: `
            <img src='/media/img/icons/video.png' style="width:30px"> 
        `},
        { title: "Product ID", name: "product_id", type: "number", align: "center", width: 40},
        { title: "Product Name", name: "product_name", type: "text", align: "center"},
        { title: "Price", name: "price", type: "number", align: "center", width: 50},
        { title: "Ad Type", name: "ad_type", type: "text", align: "center"},
        { title: "Action", name: "ad_id", type: "html", template: `
            <span>
                <button class="btn btn-primary">Edit</button>
                <button class="btn btn-warning">Pause</button>
                <button class="btn btn-danger">Del</button>
            </span>
        `, width: 100},
    ],
    controller: {
        loadData: function(filter) {
            console.log("------ loadData ", filter)
            let q = $('[name="q"]').val()
            if(q)
                filter['q'] = q
            filter['page'] = filter['pageIndex']

            return $.ajax({
                type: "GET",
                url: "/api/v1/ad/ad",
                data: filter,
                headers: headers
            });
        },
        
        insertItem: function(item) {
            return $.ajax({
                type: "POST",
                url: "/api/v1/ad/ad",
                data: item,
                headers: headers
            });
        },
        
        updateItem: function(item) {
            return $.ajax({
                type: "PUT",
                url: "/api/v1/ad/ad/"+item.ad_id + "/",
                data: item,
                headers: headers
            });
        },
        
        deleteItem: function(item) {
            return $.ajax({
                type: "DELETE",
                url: "/api/v1/ad/ad/"+item.ad_id,
                data: item,
                headers: headers
            });
        }
    },
});

let grid = $("#beneficiaryTable").data("JSGrid");
$(document).on('click', '.frequency-element', function(){
    console.log("elemetn clicked", $(this).attr('data-modalbody'))
    $($(this).attr('data-target')).find('.modal-body').html($(this).attr('data-modalbody'))
})
</script>
{% endblock local_js %}